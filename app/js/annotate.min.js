!function(a,b){function c(){b(".bubble-items .bubble").hide();var a=b("i.mdi-notification-sms-failed").index(this),c=b(this).position();console.log(b(".bubble-items .bubble:nth-of-type("+(a+1)+")").css("display"));b(this).width();b(".bubble-items .bubble:nth-of-type("+(a+1)+")").css({position:"absolute",top:c.top+30+"px",left:c.left-Math.floor(125)+7+"px"}).show()}function d(a){for(var b=[];a.parentNode;){if(a.id){b.unshift("#"+a.id);break}if(a==a.ownerDocument.documentElement)b.unshift(a.tagName);else{for(var c=1,d=a;d.previousElementSibling;d=d.previousElementSibling,c++);b.unshift(a.tagName+":nth-child("+c+")")}a=a.parentNode}return b.join(" > ")}function e(a,c){b(".materialize-textarea").val("");var e=window.getSelection().getRangeAt(0),f=e.extractContents(),g={backgroundColor:a,fontWeight:"normal",fontStyle:"normal",textDecoration:"none"},h=document.createElement("span");if(h.style.backgroundColor=a,h.className="selected-text","undefined"!=typeof c)switch(c){case"bold":h.style.fontWeight=g.fontWeight="bold";break;case"italic":h.style.fontStyle=g.fontStyle="italic";break;case"underline":h.style.textDecoration=g.textDecoration="underline";break;case"cross":h.style.textDecoration=g.textDecoration="line-through"}else h.style.fontWeight="normal",h.style.fontStyle="normal",h.style.textDecoration="none";return h.appendChild(f),e.insertNode(h),{spanStyles:g,selectionObject:e,text:h.innerText,parentCSSPath:d(h.parentNode),currentCSSPath:d(h)}}function f(){b("#text-box").find(".selected-text").contents().unwrap()}function g(a){return a.text?B.push({spanStyles:a.spanStyles,selectionObject:a.selectionObject,twitterUserID:C,twitterName:D,twitterHandle:E,highlighted_text:a.text,comment:"",path:a.currentCSSPath,parentPath:a.parentCSSPath}):void 0}function h(){var a=".off-annotation, .mdi-action-account-box",c=".on-annotation";b(a).not(c).off("mouseover"),b(a).not(c).off("mouseout"),b(a).not(c).on("mouseover",function(){b(this).css({color:"#26A69A",cursor:"pointer"})}).on("mouseout",function(){b(this).css({color:"white",cursor:"none"})})}function i(){b(this).hasClass("off-annotation")?n(b(this)):o(b(this)),k(),b(this).one("click",j)}function j(){b(this).hasClass("off-annotation")?n(b(this)):o(b(this)),k(),b(this).one("click",i)}function k(){}function l(){b(this).hasClass("off-annotation")?n(b(this)):o(b(this)),t(!0),b(this).one("click",m)}function m(){G=!1,b(".mdi-content-archive").hasClass("on-annotation")?o(b(".mdi-content-archive")):n(b(".mdi-content-archive")),b(".mdi-content-archive").one("click",l)}function n(a){a.off("mouseout"),a.addClass("on-annotation").removeClass("off-annotation"),a.css("color","#26A69A")}function o(a,c,d,e){var f="undefined"!=typeof a&&"undefined"!=typeof c&&"undefined"!=typeof d&&"undefined"!=typeof e?a.add(c).add(d).add(e):a;f.off("mouseout"),f.off("click"),f.on("mouseout",function(){b(this).css("color","white")}),f.removeClass("on-annotation").addClass("off-annotation"),f.css("color","#FFFFFF"),f.one("click",function(){p(b(this))})}function p(a){var b,c="#FEC324";a.is(M)&&(o(Q,N,O,P),b="underline",c="#FFFFFF"),a.is(N)&&(o(Q,M,O,P),b="italic",c="#FFFFFF"),a.is(O)&&(o(Q,N,M,P),b="bold",c="#FFFFFF"),a.is(P)&&(o(Q,N,O,M),b="cross",c="#FFFFFF"),n(a),r(a,b,c,"handler_two")}function q(a){var b,c="#FEC324";a.is(M)&&o(M),a.is(N)&&o(N),a.is(O)&&o(O),a.is(P)&&o(P),n(Q),r(a,b,c,"handler_one")}function r(a,c,d,e){h(),b(v).off("mouseup"),b(v).off("mousedown"),b(v).on("mouseup",function(){s(0,d,c)}),b(v).on("mousedown",function(){f()}),"handler_one"===e?a.one("click",function(){p(b(this))}):a.one("click",function(){q(b(this))})}function s(a,c,d){var f=e(c,d);1===a&&(F=f.parentCSSPath),y=g(f);var h=J[f.parentCSSPath].selector;b(h+" .comment-area textarea").off("keyup"),n(b(".mdi-editor-insert-comment")),o(b(".mdi-content-archive")),t(!1,f,h);var i=b(f.parentCSSPath+" i.mdi-notification-sms-failed").position();b(f.parentCSSPath+" i.mdi-notification-sms-failed").width();b(".bubble-items .bubble").hide(),J[f.parentCSSPath].css({position:"absolute",top:i.top+30+"px",left:i.left-Math.floor(125)+7+"px"}).show(),b(h+" .comment-area textarea").focus(),b(h+" .comment-area textarea").keyup(function(){y.update({comment:b(h+" .comment-area textarea").val()},L)})}function t(a,c,d){if(G=a,b(d+" .comment-list").animate({scrollTop:b(this).height()},"fast"),"undefined"!=typeof c)for(var e in I){var f=I[e];f.parentPath==c.parentCSSPath&&0==G&&u(e,f,d)}else for(var e in I){var f=I[e];u(e,f,d)}}function u(a,c,d){var e,f="#FEC324"==c.spanStyles.backgroundColor?"background-color:"+c.spanStyles.backgroundColor+";":"";"#FEC324"==c.spanStyles.backgroundColor&&(e="Highlighted Text"),"italic"==c.spanStyles.fontStyle&&(e="Italicized Text"),"bold"==c.spanStyles.fontWeight&&(e="Bolded Text"),"line-through"==c.spanStyles.textDecoration&&(e="Striked Text"),"underline"==c.spanStyles.textDecoration&&(e="Underlined Text"),b(d+" .comment-list .collection").append('<a href="#!" class="collection-item" style="line-height:0.7rem; font-size:10px;" id="'+a+"\"><strong style='display:inline-block; float:right;'>"+c.twitterName+"</strong><br/><span>"+e+"</span>: <br/><span class='highlighted-text' style='color:#252525; "+f+" font-style:"+c.spanStyles.fontStyle+"; font-weight:"+c.spanStyles.fontWeight+"; text-decoration:"+c.spanStyles.textDecoration+";'>"+c.highlighted_text+"</span><br/><span>Comment</span>: <br/><span class='comment-text' style='color:#252525;'>"+c.comment+"</span></li>")}var v=b("script#annotate").attr("container"),w=b("script#annotate").attr("elements");b("<style type='text/css'> .on-annotation{ color:#26A69A; } .off-annotation{ color:#FFFFFF;} .bubble{ position: relative; width: 250px; height: 350px; padding: 0px; background: #26A69A; -webkit-border-radius: 10px; -moz-border-radius: 10px; border-radius: 10px; } .bubble:after { content: ''; position: absolute; border-style: solid; border-width: 0px 20px 15px; border-color: #252525 transparent; display: block; width: 0; z-index: 1; top: -14px; left: 105px; } </style>").appendTo("head");var x=document.createElement("div");x.className="annotation",x.style.width="5%",x.style.height="12.8em",x.style.background="#252525",x.style.color="white",x.style.top="25%",x.style.bottom="25%",x.style.position="fixed",x.style.textAlign="center",x.style.right="0px",x.style.fontSize="1.6em",x.style.lineHeight="1.6em",x.style.boxShadow="0px 0px 16px rgba(0, 0, 0, 0.6)",document.body.appendChild(x),b("<i></i>").addClass("mdi-action-account-box").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-insert-comment off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-mode-edit on-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-bold off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-italic off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-color-text off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-clear off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-content-archive off-annotation").css({display:"block"}).appendTo(".annotation");var y,z=new Firebase(b("script#annotate").attr("firebase")),A=z.child(window.location.href.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"")),B=A.child("comments"),C="404",D="Anonymous",E="@Anonymous",F=null,G=!0,H={},I={},J={},K=b("<div></div>").addClass("bubble-items").appendTo(v);b("<i></i>").addClass("mdi-notification-sms-failed").css({cursor:"pointer","font-size":"15px"}).appendTo(w),b("<b></b>").addClass("comment-count").text("0").appendTo(w);b("i.mdi-notification-sms-failed").each(function(a){H[d(b(this)[0].parentNode)]=b(this);var c=b("<div></div>").addClass("bubble").css("display","none").appendTo(K),e=b("<div></div>").addClass("comment-area").css({"background-color":"#252525",width:"250px",height:"100px",padding:"0px 10px",bottom:"0px","text-align":"center",overflow:"scroll",color:"white","font-size":"8px","-webkit-border-radius":"10px 10px 0px 0px","-moz-border-radius":"10px 10px 0px 0px","border-radius":"10px 10px 0px 0px"}).appendTo(c),f=b("<div></div>").addClass("input-field").appendTo(e),g=(b("<textarea></textarea>").addClass("materialize-textarea").attr("id","textarea1").appendTo(f),b("<label></label>").attr("for","textarea1").text("Comment").appendTo(f),b("<div></div>").addClass("comment-list container").css({width:"250px",height:"250px",top:"0px","text-align":"center",overflow:"scroll",color:"white","font-size":"8px",padding:"0px",border:"1px solid #e0e0e0","-webkit-border-radius":"0px 0px 10px 10px","-moz-border-radius":"0px 0px 10px 10px","border-radius":"0px 0px 10px 10px"}).appendTo(c)),h=(b("<ul></ul>").addClass("collection").css({border:"none",margin:"0px"}).appendTo(g),b("i.mdi-notification-sms-failed").index(this));J[d(b(this)[0].parentNode)]=b(".bubble-items .bubble:nth-of-type("+(h+1)+")"),console.log(J)}),b("i.mdi-notification-sms-failed").one("click",c),b(v).on("mouseup",function(){s(1,"#FEC324")});var L=function(a){a?console.log("Synchronization failed!"):console.log("Synchronization succeeded!")};b(v).on("mousedown",function(){f()}),h(),b(".mdi-editor-format-bold").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),b(".mdi-editor-format-italic").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),b(".mdi-editor-format-color-text").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),B.on("child_added",function(a){var c=a.val(),d=a.name().substring(1);if(I[d]=c,console.log(c.parentPath),c.parentPath===F||G===!0){var e=J[c.parentPath];console.log(e),u(d,c,e.selector);var f=parseInt(b(c.parentPath+" .comment-count").text())+1;b(c.parentPath+" .comment-count").text(f)}c.parentPath in H&&b("i.mdi-notification-sms-failed").filter(function(a){return console.log("Yay!"),b(this).is(H[c.parentPath])}).css("color","#26A69A")}),B.on("child_changed",function(a){var c=a.val().comment,d=a.name().substring(1);b("#"+d+" span.comment-text").text(c),I[d].comment=c}),B.on("child_removed",function(a){var c=a.name().substring(1);b("#"+c).remove(),delete I[c]}),b(".mdi-action-account-box").on("click",function(){z.authWithOAuthPopup("twitter",function(a,b){a?console.log("Login Failed!",a):(console.log("Authenticated successfully with payload:",b),C=b.uid.split(":")[1],D=b.twitter.displayName,E=b.twitter.username)})}),b(".mdi-editor-insert-comment").one("click",i),b(".mdi-content-archive").one("click",l);var M=b(".mdi-editor-format-color-text"),N=b(".mdi-editor-format-italic"),O=b(".mdi-editor-format-bold"),P=b(".mdi-editor-format-clear"),Q=b(".mdi-editor-mode-edit");M.one("click",function(){p(b(this))}),P.one("click",function(){p(b(this))}),N.one("click",function(){p(b(this))}),O.one("click",function(){p(b(this))})}(window,jQuery);