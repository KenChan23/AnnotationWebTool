!function(a,b){function c(a){for(var b=[];a.parentNode;){if(a.id){b.unshift("#"+a.id);break}if(a==a.ownerDocument.documentElement)b.unshift(a.tagName);else{for(var c=1,d=a;d.previousElementSibling;d=d.previousElementSibling,c++);b.unshift(a.tagName+":nth-child("+c+")")}a=a.parentNode}return b.join(" > ")}function d(a,d){b(".materialize-textarea").val("");var e=window.getSelection().getRangeAt(0);console.log(typeof e);var f=e.extractContents(),g={backgroundColor:a,fontWeight:"normal",fontStyle:"normal",textDecoration:"none"},h=document.createElement("span");if(h.style.backgroundColor=a,h.className="selected-text","undefined"!=typeof d)switch(d){case"bold":h.style.fontWeight=g.fontWeight="bold";break;case"italic":h.style.fontStyle=g.fontStyle="italic";break;case"underline":h.style.textDecoration=g.textDecoration="underline";break;case"cross":h.style.textDecoration=g.textDecoration="line-through"}else h.style.fontWeight="normal",h.style.fontStyle="normal",h.style.textDecoration="none";return h.appendChild(f),e.insertNode(h),{spanStyles:g,selectionObject:e,text:h.innerText,parentCSSPath:c(h.parentNode),currentCSSPath:c(h)}}function e(){b("#text-box").find(".selected-text").contents().unwrap()}function f(a){return a.text?(console.log(a.spanElement),console.log(a.selectionObject),C.push({spanStyles:a.spanStyles,selectionObject:a.selectionObject,twitterUserID:D,twitterName:E,twitterHandle:F,highlighted_text:a.text,comment:"",path:a.currentCSSPath,parentPath:a.parentCSSPath})):void 0}function g(){var a=".off-annotation, .mdi-action-account-box",c=".on-annotation";b(a).not(c).off("mouseover"),b(a).not(c).off("mouseout"),b(a).not(c).on("mouseover",function(){b(this).css({color:"#26A69A",cursor:"pointer"})}).on("mouseout",function(){b(this).css({color:"white",cursor:"none"})})}function h(){b(this).hasClass("off-annotation")?n(b(this)):o(b(this)),j(),b(this).one("click",i)}function i(){b(this).hasClass("off-annotation")?n(b(this)):o(b(this)),j(),b(this).one("click",h)}function j(){b(".comment-area").toggle(function(){b(".comment-area").animate({right:"-15%"},"fast")},function(){b(".comment-area").animate({right:"0%"},"fast")})}function k(){n(b(this)),m(),b(this).one("click",l)}function l(){o(b(this)),m(),b(this).one("click",k)}function m(){b(".comment-list").toggle(function(){b(".comment-list").animate({right:"-15%"},"fast")},function(){b(".comment-list").animate({right:"0%"},"fast")})}function n(a){a.off("mouseout"),a.addClass("on-annotation").removeClass("off-annotation"),a.css("color","#26A69A")}function o(a,c,d,e){var f="undefined"!=typeof a&&"undefined"!=typeof c&&"undefined"!=typeof d&&"undefined"!=typeof e?a.add(c).add(d).add(e):a;f.off("mouseout"),f.off("click"),f.on("mouseout",function(){b(this).css("color","white")}),f.removeClass("on-annotation").addClass("off-annotation"),f.css("color","#FFFFFF"),f.one("click",function(){p(b(this))})}function p(a){var b,c="#FEC324";a.is(M)&&(o(Q,N,O,P),b="underline",c="#FFFFFF"),a.is(N)&&(o(Q,M,O,P),b="italic",c="#FFFFFF"),a.is(O)&&(o(Q,N,M,P),b="bold",c="#FFFFFF"),a.is(P)&&(o(Q,N,O,M),b="cross",c="#FFFFFF"),n(a),r(a,b,c,"handler_two")}function q(a){var b,c="#FEC324";a.is(M)&&o(M),a.is(N)&&o(N),a.is(O)&&o(O),a.is(P)&&o(P),n(Q),r(a,b,c,"handler_one")}function r(a,c,d,f){g(),b(x).off("mouseup"),b(x).off("mousedown"),b(x).on("mouseup",function(){s(a,c,d)}),b(x).on("mousedown",function(){e()}),"handler_one"===f?a.one("click",function(){p(b(this))}):a.one("click",function(){q(b(this))})}function s(a,c,e){b(".comment-area textarea").off("keyup");var g=d(e,c);G=g.parentCSSPath,z=f(g),n(b(".mdi-editor-insert-comment")),("-15%"===b(".comment-area").css("right")||"0%"===b(".comment-area").css("right"))&&b(".comment-area").css("display","block").animate({right:"0%"},"fast"),n(b(".mdi-action-view-headline")),o(b(".mdi-content-archive")),H=!1,("-15%"===b(".comment-list").css("right")||"0%"===b(".comment-list").css("right"))&&b(".comment-list").css("display","block").animate({right:"0%"},"fast"),b(".comment-list .collection").empty();for(var h in I){var i=I[h];i.parentPath==g.parentCSSPath&&b(".comment-list .collection").append('<a href="#!" class="collection-item" style="line-height:0.5rem;" id="'+h+'"><strong>'+i.twitterName+"</strong>: <br/><em style='color: #252525;'>Highlighted Text</em>: <br/><span class='highlighted-text'>"+i.highlighted_text+"</span><br/><em style='color: #252525;''>Comment</em>: <br/><span class='comment-text'>"+i.comment+"</span></li>")}b(".comment-area textarea").focus(),b(".comment-area textarea").keyup(function(){z.update({comment:b(".comment-area textarea").val()},L)})}function t(){b(this).hasClass("off-annotation")?n(b(this)):o(b(this)),b(this).one("click",u)}function u(){b(".mdi-action-view-headline").hasClass("on-annotation")?o(b(".mdi-action-view-headline")):n(b(".mdi-action-view-headline")),b(".mdi-action-view-headline").one("click",t)}function v(){b(this).hasClass("off-annotation")?n(b(this)):o(b(this)),H=!0,("-15%"===b(".comment-list").css("right")||"0%"===b(".comment-list").css("right"))&&b(".comment-list").css("display","block").animate({right:"0%"},"fast"),b(".comment-list .collection").empty();for(var a in I){var c=I[a];b(".comment-list .collection").append('<a href="#!" class="collection-item" style="line-height:0.5rem;" id="'+a+'"><strong>'+c.twitterName+"</strong>: <br/><em style='color: #252525;'>Highlighted Text</em>: <br/><span class='highlighted-text'>"+c.highlighted_text+"</span><br/><em style='color: #252525;''>Comment</em>: <br/><span class='comment-text'>"+c.comment+"</span></li>")}b(this).one("click",w)}function w(){H=!1,b(".mdi-content-archive").hasClass("on-annotation")?o(b(".mdi-content-archive")):n(b(".mdi-content-archive")),b(".mdi-content-archive").one("click",v)}var x=b("script#annotate").attr("container");console.log(x),b("<style type='text/css'> .on-annotation{ color:#26A69A; } .off-annotation{ color:#FFFFFF;}</style>").appendTo("head");var y=document.createElement("div");y.className="annotation",y.style.width="5%",y.style.height="14.4em",y.style.background="#252525",y.style.color="white",y.style.top="25%",y.style.bottom="25%",y.style.position="fixed",y.style.textAlign="center",y.style.right="0px",y.style.fontSize="1.6em",y.style.lineHeight="1.6em",y.style.boxShadow="0px 0px 16px rgba(0, 0, 0, 0.6)",document.body.appendChild(y),b("<i></i>").addClass("mdi-action-account-box").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-insert-comment off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-mode-edit on-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-bold off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-italic off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-color-text off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-clear off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-action-view-headline off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-content-archive off-annotation").css({display:"block"}).appendTo(".annotation");var z,A=new Firebase(b("script#annotate").attr("firebase")),B=A.child(window.location.href.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"")),C=B.child("comments"),D="404",E="Anonymous",F="@Anonymous",G=null,H=!0,I={},J=document.createElement("div");J.className="comment-area",J.style.background="#252525",J.style.width="15%",J.style.height="20%",J.style.padding="0px 10px",J.style.display="none",J.style.top="0%",J.style.bottom="80%",J.style.position="fixed",J.style.textAlign="center",J.style.right="0%",J.style.overflow="scroll",J.style.color="white",J.style.fontSize="8px",J.style.boxShadow="0px 0px 16px rgba(0, 0, 0, 0.6)",document.body.appendChild(J),b("<div></div>").addClass("input-field").appendTo(".comment-area"),b("<textarea></textarea>").addClass("materialize-textarea").attr("id","textarea1").appendTo(".input-field"),b("<label></label>").attr("for","textarea1").text("Comment").appendTo(".input-field");var K=document.createElement("div");K.className="comment-list container",K.style.background="#252525",K.style.width="15%",K.style.height="20%",K.style.display="none",K.style.top="80%",K.style.bottom="0%",K.style.position="fixed",K.style.textAlign="center",K.style.right="0%",K.style.overflow="scroll",K.style.color="white",K.style.fontSize="8px",K.style.boxShadow="0px 0px 16px rgba(0, 0, 0, 0.6)",document.body.appendChild(K),b("<ul></ul>").addClass("collection").css("border","none").appendTo(".comment-list"),b(x).on("mouseup",function(){b(".comment-area textarea").off("keyup");var a=d("#FEC324");G=a.parentCSSPath,z=f(a),n(b(".mdi-editor-insert-comment")),("-15%"===b(".comment-area").css("right")||"0%"===b(".comment-area").css("right"))&&b(".comment-area").css("display","block").animate({right:"0%"},"fast"),n(b(".mdi-action-view-headline")),o(b(".mdi-content-archive")),H=!1,("-15%"===b(".comment-list").css("right")||"0%"===b(".comment-list").css("right"))&&b(".comment-list").css("display","block").animate({right:"0%"},"fast"),console.log("Before empty"),b(".comment-list .collection").empty(),console.log("After empty");for(var c in I){var e=I[c];e.parentPath==a.parentCSSPath&&b(".comment-list .collection").append('<a href="#!" class="collection-item" style="line-height:0.5rem;" id="'+c+'"><strong>'+e.twitterName+"</strong>: <br/><em style='color: #252525;'>Highlighted Text</em>: <br/><span class='highlighted-text'>"+e.highlighted_text+"</span><br/><em style='color: #252525;''>Comment</em>: <br/><span class='comment-text'>"+e.comment+"</span></li>")}console.log("After loop"),b(".comment-area textarea").focus(),b(".comment-area textarea").keyup(function(){z.update({comment:b(".comment-area textarea").val()},L)})});var L=function(a){a?console.log("Synchronization failed!"):console.log("Synchronization succeeded!")};b(x).on("mousedown",function(){e()}),b(".selected-text").on("click",function(){console.log(b(this))}),g(),b(".mdi-editor-format-bold").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),b(".mdi-editor-format-italic").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),b(".mdi-editor-format-color-text").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),C.on("child_added",function(a){var c=a.val(),d=a.name().substring(1);I[d]=c,(c.parentPath===G||H===!0)&&b(".comment-list .collection").append('<a href="#!" class="collection-item" style="line-height:0.5rem;" id="'+d+'"><strong>'+c.twitterName+"</strong>: <br/><em style='color: #252525;'>Highlighted Text</em>: <br/><span class='highlighted-text'>"+c.highlighted_text+"</span><br/><em style='color: #252525;''>Comment</em>: <br/><span class='comment-text'>"+c.comment+"</span></li>")}),C.on("child_changed",function(a){var c=a.val().comment,d=a.name().substring(1);b("#"+d+" span.comment-text").text(c),I[d].comment=c}),C.on("child_removed",function(a){var c=a.name().substring(1);b("#"+c).remove(),delete I[c]}),b(".mdi-action-account-box").on("click",function(){A.authWithOAuthPopup("twitter",function(a,b){a?console.log("Login Failed!",a):(console.log("Authenticated successfully with payload:",b),D=b.uid.split(":")[1],E=b.twitter.displayName,F=b.twitter.username)})}),b(".mdi-editor-insert-comment").one("click",h),b(".mdi-action-view-headline").one("click",k);var M=b(".mdi-editor-format-color-text"),N=b(".mdi-editor-format-italic"),O=b(".mdi-editor-format-bold"),P=b(".mdi-editor-format-clear"),Q=b(".mdi-editor-mode-edit");M.one("click",function(){p(b(this))}),P.one("click",function(){p(b(this))}),N.one("click",function(){p(b(this))}),O.one("click",function(){p(b(this))}),b(".mdi-action-view-headline").one("click",t),b(".mdi-content-archive").one("click",v)}(window,jQuery);