!function(a,b){function c(){b(".bubble-items .bubble").hide();var a=b("i.mdi-notification-sms-failed").index(this),c=b(this).position();b(this).width();b(".bubble-items .bubble:nth-of-type("+(a+1)+")").css({position:"absolute",top:c.top+30+"px",left:c.left-Math.floor(125)+7+"px"}).show()}function d(a){for(var b=[];a.parentNode;){if(a.id){b.unshift("#"+a.id);break}if(a==a.ownerDocument.documentElement)b.unshift(a.tagName);else{for(var c=1,d=a;d.previousElementSibling;d=d.previousElementSibling,c++);b.unshift(a.tagName+":nth-child("+c+")")}a=a.parentNode}return b.join(" > ")}function e(a,c,e,f){var g,h;console.log(f),b(".materialize-textarea").val(""),g="undefined"==typeof e?H?void 0:window.getSelection().getRangeAt(0):e,"undefined"!=typeof g&&(h=g.extractContents());var i={backgroundColor:a,fontWeight:"normal",fontStyle:"normal",textDecoration:"none"},j=document.createElement("span");if(j.style.backgroundColor=a,j.className="selected-text","undefined"!=typeof c)switch(c){case"bold":j.style.fontWeight=i.fontWeight="bold";break;case"italic":j.style.fontStyle=i.fontStyle="italic";break;case"underline":j.style.textDecoration=i.textDecoration="underline";break;case"cross":j.style.textDecoration=i.textDecoration="line-through"}else j.style.fontWeight="normal",j.style.fontStyle="normal",j.style.textDecoration="none";return"undefined"!=typeof g?(j.appendChild(h),g.insertNode(j),actualText=j.textContent,{selection:g,spanStyles:i,selectionObject:g,text:actualText,parentCSSPath:d(j.parentNode),currentCSSPath:d(j)}):(actualText="",{selection:g,spanStyles:i,selectionObject:g,text:actualText,parentCSSPath:d(f[0]),currentCSSPath:d(f[0])})}function f(){b("#text-box").find(".selected-text").contents().unwrap()}function g(a){return console.log(H),a.text&&!H?A.push({spanStyles:a.spanStyles,twitterUserID:B,twitterName:C,twitterHandle:D,highlighted_text:a.text,comment:"",path:a.currentCSSPath,parentPath:a.parentCSSPath}):H?(H=!1,A.push({spanStyles:a.spanStyles,twitterUserID:B,twitterName:C,twitterHandle:D,highlighted_text:"** General **",comment:"",path:a.currentCSSPath,parentPath:a.parentCSSPath})):!1}function h(){var a=".off-annotation, .mdi-action-account-box",c=".on-annotation";b(a).not(c).off("mouseover"),b(a).not(c).off("mouseout"),b(a).not(c).on("mouseover",function(){b(this).css({color:"#26A69A",cursor:"pointer"})}).on("mouseout",function(){b(this).css({color:"white",cursor:"none"})})}function i(){b(this).hasClass("off-annotation")?m(b(this)):(n(b(this)),b(".bubble-items .bubble textarea").blur(),b(".bubble-items .bubble").hide()),b(this).one("click",j)}function j(){b(this).hasClass("off-annotation")?m(b(this)):(n(b(this)),b(".bubble-items .bubble textarea").blur(),b(".bubble-items .bubble").hide()),b(this).one("click",i)}function k(){b(this).hasClass("off-annotation")?m(b(this)):n(b(this)),t(!0,void 0,".entire-collection"),b(this).one("click",l)}function l(){b(this).hasClass("off-annotation")?m(b(this)):n(b(this)),t(!1,void 0,".entire-collection"),b(this).one("click",k)}function m(a){a.off("mouseout"),a.addClass("on-annotation").removeClass("off-annotation"),a.css("color","#26A69A")}function n(a,c,d,e){var f="undefined"!=typeof a&&"undefined"!=typeof c&&"undefined"!=typeof d&&"undefined"!=typeof e?a.add(c).add(d).add(e):a;f.off("mouseout"),f.on("mouseout",function(){b(this).css("color","white")}),f.removeClass("on-annotation").addClass("off-annotation"),f.css("color","#FFFFFF"),f.hasClass("mdi-content-archive")||(f.off("click"),f.one("click",function(){o(b(this))}))}function o(a){var b,c="#FEC324";a.is(O)&&(n(S,P,Q,R),b="underline",c="#FFFFFF"),a.is(P)&&(n(S,O,Q,R),b="italic",c="#FFFFFF"),a.is(Q)&&(n(S,P,O,R),b="bold",c="#FFFFFF"),a.is(R)&&(n(S,P,Q,O),b="cross",c="#FFFFFF"),m(a),q(a,b,c,"handler_two")}function p(a){var b,c="#FEC324";a.is(O)&&n(O),a.is(P)&&n(P),a.is(Q)&&n(Q),a.is(R)&&n(R),m(S),q(a,b,c,"handler_one")}function q(a,c,d,e){h(),b(v).off("mouseup"),b(v).off("mousedown"),b(v).on("mouseup",function(a){b(".mdi-editor-format-bold").hasClass("off-annotation")&&b(".mdi-editor-format-italic").hasClass("off-annotation")&&b(".mdi-editor-format-color-text").hasClass("off-annotation")&&b(".mdi-editor-format-clear").hasClass("off-annotation")?(m(S),d="#FEC324"):d="#FFFFFF",console.log(d),b(a.target).hasClass("mdi-notification-sms-failed")?(n(O,P,Q,R),console.log("Inside here..."),d="#90CAF9",H=!0,c=void 0,r(d,c,void 0,b(this))):(H=!1,r(d,c))}),b(v).on("mousedown",function(){f()}),"handler_one"===e?a.one("click",function(){o(b(this))}):a.one("click",function(){p(b(this))})}function r(a,c,d,f){var g;g=H?e(a,c,d,f):e(a,c,d),console.log("Selected Object",g),E=g.parentCSSPath;var h=K[g.parentCSSPath].selector;if(H){b(h+" textarea").focus();var i="";b(h+" textarea").off("change keyup paste"),b(h+" textarea").on("change keyup paste",function(){var a=b(this).val();a!=i&&(i=a,b(this).off("change keyup paste"),s(g,h,f))})}else console.log("Testing from within"),s(g,h)}function s(a,d,e){function f(c){b(c+" .comment-area textarea").val(""),H=!0,"undefined"==typeof e?(console.log("Need this reference..."),r("#90CAF9",void 0,a.selection)):(console.log("New to this..."),r("#90CAF9",void 0,void 0,e))}if(console.log(a),x=g(a),console.log(K[a.parentCSSPath].selector),x){b(d+" .comment-area textarea").off("keyup"),b("i.mdi-notification-sms-failed").off("click"),b("i.mdi-notification-sms-failed").one("click",c),m(b(".mdi-editor-insert-comment")),n(b(".mdi-content-archive"));var h=b(a.parentCSSPath+" i.mdi-notification-sms-failed").position();b(a.parentCSSPath+" i.mdi-notification-sms-failed").width();b(".bubble-items .bubble").hide(),console.log(K[a.parentCSSPath].selector),K[a.parentCSSPath].css({position:"absolute",top:h.top+30+"px",left:h.left-Math.floor(125)+7+"px"}).show();var i=b(d+" .comment-list")[0].scrollHeight;b(d+" .comment-list").animate({scrollTop:i},"fast"),b(d+" .comment-area textarea").focus(),b(d+" .comment-area textarea").keyup(function(){x.update({comment:b(d+" .comment-area textarea").val()},N)}),b(d+" .mdi-content-add").off("click"),b(d+" .mdi-content-add").on("click",function(){f(d)})}}function t(a,c,d){F=a,1==F?(b("#overlay").show(),b("#all-comments-list").show(),b("#overall-counter").show()):(b("#overlay").hide(),b("#all-comments-list").hide(),b("#overall-counter").hide())}function u(a,c,d){var e,f,g=c.spanStyles.backgroundColor,h="#FEC324"==g||"#90CAF9"==g?"background-color:"+c.spanStyles.backgroundColor+";":"";e="#FEC324"==c.spanStyles.backgroundColor?"Highlighted Text":"italic"==c.spanStyles.fontStyle?"Italicized Text":"bold"==c.spanStyles.fontWeight?"Bolded Text":"line-through"==c.spanStyles.textDecoration?"Striked Text":"underline"==c.spanStyles.textDecoration?"Underlined Text":"No Text Selected",f=b(".entire-collection"==d?".entire-collection":d+" .comment-list .collection"),f.append('<a href="#!" style="line-height:0.7rem; font-size:10px;" class="collection-item '+a+"\"><strong style='display:inline-block; float:right;'>"+c.twitterName+"</strong><br/><span>"+e+"</span>: <br/><span class='highlighted-text' style='color:#252525; "+h+" font-style:"+c.spanStyles.fontStyle+"; font-weight:"+c.spanStyles.fontWeight+"; text-decoration:"+c.spanStyles.textDecoration+";'>"+c.highlighted_text+"</span><br/><span>Comment</span>: <br/><span class='comment-text' style='color:#252525;'>"+c.comment+"</span></li>")}var v=(b("script#annotate").attr("container"),b("script#annotate").attr("elements"));b("<style type='text/css'> .on-annotation{ color:#26A69A; } .off-annotation{ color:#FFFFFF;} .bubble{ position: relative; width: 250px; height: 350px; padding: 0px; background: #26A69A; -webkit-border-radius: 10px; -moz-border-radius: 10px; border-radius: 10px; } .bubble:after { content: ''; position: absolute; border-style: solid; border-width: 0px 20px 15px; border-color: #252525 transparent; display: block; width: 0; top: -14px; left: 105px; } </style>").appendTo("head");var w=document.createElement("div");w.className="annotation",w.style.width="5%",w.style.height="12.8em",w.style.background="#252525",w.style.color="white",w.style.top="25%",w.style.bottom="25%",w.style.position="fixed",w.style.textAlign="center",w.style.right="0px",w.style.fontSize="1.6em",w.style.lineHeight="1.6em",w.style.boxShadow="0px 0px 16px rgba(0, 0, 0, 0.6)",document.body.appendChild(w),b("<i></i>").addClass("mdi-action-account-box").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-insert-comment off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-mode-edit on-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-bold off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-italic off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-color-text off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-editor-format-clear off-annotation").css("display","block").appendTo(".annotation"),b("<i></i>").addClass("mdi-content-archive off-annotation").css({display:"block"}).appendTo(".annotation");var x,y=new Firebase(b("script#annotate").attr("firebase")),z=y.child(window.location.href.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"")),A=z.child("comments"),B="404",C="Anonymous",D="@Anonymous",E=null,F=!1,G=!0,H=!1,I={},J={},K={},L=b("<div></div>").addClass("bubble-items").appendTo(b("body")),M=(b("<div></div>").attr("id","overlay").css({height:"100%",width:"95%",position:"fixed","background-color":"rgba(0,0,0,0.5)",top:"0%",left:"0%",display:"none"}).appendTo(b("body")),b("<div></div>").addClass("container").attr("id","all-comments-list").css({height:"50%",width:"30%",position:"fixed",top:"25%",left:"35%","background-color":"0px 0px 16px rgba(0,0,0,0.6)","box-shadow":"0px 0px 16px rgba(0,0,0,0.6)",display:"none","text-align":"center",overflow:"scroll","font-size":"8px",padding:"0px",border:"1px solid #e0e0e0"}).appendTo(b("body")));b("<ul></ul>").addClass("entire-collection collection").css({border:"none",margin:"0px"}).appendTo(M),b("<div></div>").attr("id","overall-counter").css({top:"15%",height:"5%",width:"5%",position:"fixed",left:"49%","font-size":"3rem",color:"white","text-shadow":"rgba(0, 0, 0, 0.6) 0px 0px 16px",display:"none"}).text(0).appendTo(b("body")),b("<i></i>").addClass("mdi-notification-sms-failed").css({cursor:"pointer","font-size":"15px"}).appendTo(v),b("<b></b>").addClass("comment-count").css("font-size","15px").text("0").appendTo(v);b("i.mdi-notification-sms-failed").each(function(a){I[d(b(this)[0].parentNode)]=b(this);var c=b("<div></div>").addClass("bubble").css("display","none").appendTo(L),e=b("<div></div>").addClass("comment-area").css({"background-color":"#252525",width:"250px",height:"100px",padding:"0px 10px",bottom:"0px","text-align":"center",overflow:"scroll",color:"white","font-size":"8px","-webkit-border-radius":"10px 10px 0px 0px","-moz-border-radius":"10px 10px 0px 0px","border-radius":"10px 10px 0px 0px"}).appendTo(c),f=b("<div></div>").addClass("input-field").appendTo(e),g=(b("<textarea></textarea>").addClass("materialize-textarea").attr("id","textarea1").appendTo(f),b("<label></label>").attr("for","textarea1").text("Comment").appendTo(f),b("<a></a>").addClass("btn-floating btn-large waves-effect waves-light").css({position:"absolute",top:"0rem",right:"0.1rem",width:"20px",height:"20px","z-index":"0"}).appendTo(f)),h=(b("<i></i>").addClass("mdi-content-add").css({"line-height":"20px",bottom:"5px",position:"relative",bottom:"12px","font-size":"1.3rem"}).appendTo(g),b("<div></div>").addClass("comment-list container").css({width:"250px",height:"250px",top:"0px","text-align":"center",overflow:"scroll",color:"white","font-size":"8px",padding:"0px",border:"1px solid #e0e0e0","-webkit-border-radius":"0px 0px 10px 10px","-moz-border-radius":"0px 0px 10px 10px","border-radius":"0px 0px 10px 10px"}).appendTo(c)),i=(b("<ul></ul>").addClass("collection").css({border:"none",margin:"0px"}).appendTo(h),b("i.mdi-notification-sms-failed").index(this));K[d(b(this)[0].parentNode)]=b(".bubble-items .bubble:nth-of-type("+(i+1)+")")}),b("i.mdi-notification-sms-failed").one("click",c),b(v).on("mouseup",function(a){b(a.target).hasClass("mdi-notification-sms-failed")?(console.log("Somewhere over the rainbow..."),H=!0,r("#90CAF9",void 0,void 0,b(this))):r("#FEC324")});var N=function(a){a?console.log("Synchronization failed!"):console.log("Synchronization succeeded!")};b(v).on("mousedown",function(){f()}),h(),b(".mdi-editor-format-bold").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),b(".mdi-editor-format-italic").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),b(".mdi-editor-format-color-text").on("click",function(){b(".annotate").css("color","#26A69A"),b(this).css("color","#26A69A")}),A.on("child_added",function(a){var c=a.val(),d=a.name().split("-").join("");if(J[d]=c,c.parentPath===E||G===!0){var e=K[c.parentPath];console.log(d),u(d,c,e.selector),u(d,c,".entire-collection");var f=parseInt(b(c.parentPath+" .comment-count").text())+1;b(c.parentPath+" .comment-count").text(f);var g=parseInt(b("#overall-counter").text())+1;b("#overall-counter").text(g);var h=b(e.selector+" .comment-list")[0].scrollHeight;b(e.selector+" .comment-list").animate({scrollTop:h},"fast");var i=b("#all-comments-list")[0].scrollHeight;b("#all-comments-list").animate({scrollTop:i},"fast")}c.parentPath in I&&b("i.mdi-notification-sms-failed").filter(function(a){return b(this).is(I[c.parentPath])}).css("color","#26A69A")}),A.on("child_changed",function(a){var c=a.val().comment,d=a.name().split("-").join("");b("."+d+" span.comment-text").text(c),J[d].comment=c}),A.on("child_removed",function(a){var c=a.name().split("-").join("");b("."+c).remove();var d=parseInt(b(a.val().parentPath+" .comment-count").text())-1;b(a.val().parentPath+" .comment-count").text(d);var e=parseInt(b("#overall-counter").text())-1;b("#overall-counter").text(e),delete J[c]}),b(".mdi-action-account-box").on("click",function(){y.authWithOAuthPopup("twitter",function(a,b){a?console.log("Login Failed!",a):(console.log("Authenticated successfully with payload:",b),B=b.uid.split(":")[1],C=b.twitter.displayName,D=b.twitter.username)})}),b(".mdi-editor-insert-comment").one("click",i),b(".mdi-content-archive").one("click",k);var O=b(".mdi-editor-format-color-text"),P=b(".mdi-editor-format-italic"),Q=b(".mdi-editor-format-bold"),R=b(".mdi-editor-format-clear"),S=b(".mdi-editor-mode-edit");O.one("click",function(){o(b(this))}),R.one("click",function(){o(b(this))}),P.one("click",function(){o(b(this))}),Q.one("click",function(){o(b(this))})}(window,jQuery);